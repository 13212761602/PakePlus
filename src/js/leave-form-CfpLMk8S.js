var l=(g,c,a)=>new Promise((m,d)=>{var y=o=>{try{i(a.next(o))}catch(p){d(p)}},s=o=>{try{i(a.throw(o))}catch(p){d(p)}},i=o=>o.done?m(o.value):Promise.resolve(o.value).then(y,s);i((a=a.apply(g,c)).next())});import{bh as I,aG as N,at as j,as as z,am as $}from"./bootstrap-CbEyMBZc.js";import{d as q,B as _,p as E,E as U,v as G,X as v,l as L,h as Y,o as h,w as D,j as O,W as P,f as B,c as X,a as w,b as C,k as F}from"../jse/index-index-CKHiV3bJ.js";import{u as J}from"./form-DcAycvJX.js";import{s as K}from"./index-BCokd8-c.js";import{_ as Q}from"./apply-modal.vue_vue_type_script_setup_true_lang-BYUn1leE.js";import"./approval-card.vue_vue_type_style_index_0_scoped_90981e93_lang-CFyUrHXN.js";import"./vxe-table-5UTMlFMN.js";/* empty css                                                          */import{c as Z,d as tt,e as et}from"./index-D_kbQ9_B.js";import{m as ot}from"./data-qOrCV6xU.js";import{_ as at}from"./leave-description.vue_vue_type_script_setup_true_lang-Caq0_nPX.js";import{C as rt}from"./index-BPV6pKaP.js";import{u as st}from"./use-modal-BtBQhM0d.js";import"./use-vben-form-CDDuv56b.js";import"./index-C0ExvxMt.js";import"./checkbox.vue_vue_type_script_setup_true_lang-53DrAgf8.js";import"./render-content.vue_vue_type_script_lang-h-IJYrAt.js";import"./copy-component.vue_vue_type_script_setup_true_lang-9yx0-G2y.js";import"./user-select-modal-CF4g6nsp.js";import"./index-CoycSe17.js";import"./helper-CgBacOxF.js";import"./dept-tree.vue_vue_type_script_setup_true_lang-BEss8Sse.js";import"./index-Bn5n5c2e.js";import"./Search-BSSOOXXu.js";import"./statusUtils-BVmAuBuf.js";import"./BaseInput-B-KbMaIq.js";import"./css-Dmgy8YJo.js";import"./index-CWS-moKy.js";import"./SearchOutlined-wPvswOvm.js";import"./index-Bo5G3-h7.js";import"./index-B4Ee8RY3.js";import"./SyncOutlined-CaKwXa3d.js";import"./index-DcmIf06E.js";import"./index-C2Ye5jbl.js";import"./List-CkKZPkf7.js";import"./eagerComputed-ClTeoNNc.js";import"./index-CKqqy29x.js";import"./use-vxe-grid-jJsowVf7.js";import"./init-5GXIIGpx.js";import"./avatar.vue_vue_type_script_setup_true_lang-CZ6M6Zo9.js";import"./index-CUsW12bK.js";import"./LeftOutlined-D2uSfO0F.js";import"./x-C_lPlK2i.js";import"./index-CxSj1uA5.js";import"./index-7E7RpNGb.js";import"./relativeTime-C5B3Wg5z.js";import"./approval-content.vue_vue_type_script_setup_true_lang-JZv4tt6H.js";import"./vuedraggable.umd-Cwsj9bYW.js";import"./options-tag.vue_vue_type_script_setup_true_lang-ixeCQrr7.js";import"./index-D7oCs85i.js";import"./render-C2mFGEaj.js";import"./index-cCfXrJ1Q.js";import"./index-BLUHc0Mr.js";import"./data-CsrVBQ4i.js";import"./index-BQy1gs98.js";import"./dict-LWP2femj.js";import"./json-preview.vue_vue_type_style_index_0_lang-D-h_IPZe.js";import"./get-popup-container-P4S1sr5h.js";import"./index-vRRmcGk_.js";import"./index-65hk_V-f.js";import"./index-CQDwpHx9.js";import"./shallowequal-BSzQCceG.js";import"./uniq-DFnFScdj.js";import"./Overflow-1mM_ifyS.js";import"./slide-BYSN4a27.js";import"./Dropdown-CEQGVhtH.js";import"./pick-DDCWWYz_.js";import"./isMobile-8sZ0LT6r.js";const it={id:"leave-form"},mt={key:1,class:"flex justify-end gap-2"},ke=q({__name:"leave-form",setup(g){var M,V;const c=I(),a=((M=c.query)==null?void 0:M.readonly)==="true",m=(V=c.query)==null?void 0:V.id,d=_(()=>!a),[y,s]=J({commonConfig:{formItemClass:"col-span-2",labelWidth:100,componentProps:{class:"w-full",disabled:a}},schema:ot(!a),showDefaultActions:!1,wrapperClass:"grid-cols-2"}),i=E(),o=_(()=>a&&i.value),p=U("cardRef");G(()=>l(null,null,function*(){if(m){const e=yield Z(m);i.value=e,yield s.setValues(e);const t=[v(e.startDate),v(e.endDate)];yield s.setFieldValue("dateRange",t),a&&(window.parent.postMessage({type:"mounted"},"*"),setTimeout(()=>{var u,f;const r=(u=p.value)==null?void 0:u.$el,n=(f=r==null?void 0:r.offsetHeight)!=null?f:0;n&&window.parent.postMessage({type:"height",height:n},"*")}))}}));const k=N();function b(){return l(this,null,function*(){const{valid:e}=yield s.validate();if(!e)return;let t=z(yield s.getValues());return t=$(t,"flowType"),t.startDate=v(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.endDate=v(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),m?(t.id=m,yield tt(t)):yield et(t)})}const[A,R]=st({connectedComponent:Q});function S(){return l(this,null,function*(){try{yield b(),k.push("/demo/leave")}catch(e){console.error(e)}})}function T(){return l(this,null,function*(){var e;try{const t=yield b(),r={leaveDays:t.leaveDays,userList:["1","3","4"]},n=yield s.getValues(),u=(e=n==null?void 0:n.flowType)!=null?e:"leave1",f={businessId:t.id,flowCode:u,variables:r},{taskId:W}=yield K(f);R.setData({taskId:W,taskVariables:r,variables:{}}),R.open()}catch(t){console.error(t)}})}function x(){s.resetForm(),k.push("/demo/leave")}const H=_(()=>o.value?"small":"default");return(e,t)=>{const r=L("a-button");return h(),Y(C(rt),{ref_key:"cardRef",ref:p,size:H.value},{default:D(()=>[O("div",it,[P(w(C(y),null,null,512),[[j,!o.value]]),o.value?(h(),Y(at,{key:0,data:i.value},null,8,["data"])):B("",!0),d.value?(h(),X("div",mt,[w(r,{onClick:S},{default:D(()=>t[0]||(t[0]=[F("暂存")])),_:1,__:[0]}),w(r,{type:"primary",onClick:T},{default:D(()=>t[1]||(t[1]=[F("提交")])),_:1,__:[1]})])):B("",!0),w(C(A),{onComplete:x})])]),_:1},8,["size"])}}});export{ke as default};
