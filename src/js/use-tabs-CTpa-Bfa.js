var W=Object.defineProperty,V=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var P=(t,e,a)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,T=(t,e)=>{for(var a in e||(e={}))R.call(e,a)&&P(t,a,e[a]);if(p)for(var a of p(e))_.call(e,a)&&P(t,a,e[a]);return t},x=(t,e)=>V(t,q(e));var B=(t,e)=>{var a={};for(var s in t)R.call(t,s)&&e.indexOf(s)<0&&(a[s]=t[s]);if(t!=null&&p)for(var s of p(t))e.indexOf(s)<0&&_.call(t,s)&&(a[s]=t[s]);return a};var o=(t,e,a)=>new Promise((s,n)=>{var i=l=>{try{h(a.next(l))}catch(d){n(d)}},b=l=>{try{h(a.throw(l))}catch(d){n(d)}},h=l=>l.done?s(l.value):Promise.resolve(l.value).then(i,b);h((a=a.apply(t,e)).next())});import{bo as z,aG as F,bh as G}from"./bootstrap-CbEyMBZc.js";import{a9 as j,aa as H,ab as J,a2 as Q,A as X}from"../jse/index-index-CKHiV3bJ.js";const Y=z("core-tabbar",{actions:{_bulkCloseByPaths(t){return o(this,null,function*(){this.tabs=this.tabs.filter(e=>!t.includes(c(e))),this.updateCacheTabs()})},_close(t){const{fullPath:e}=t;if(r(t))return;const a=this.tabs.findIndex(s=>s.fullPath===e);a!==-1&&this.tabs.splice(a,1)},_goToDefaultTab(t){return o(this,null,function*(){if(this.getTabs.length<=0)return;const e=this.getTabs[0];e&&(yield this._goToTab(e,t))})},_goToTab(t,e){return o(this,null,function*(){const{params:a,path:s,query:n}=t,i={params:a||{},path:s,query:n||{}};yield e.replace(i)})},addTab(t){var s,n;const e=Z(t);if(!$(e))return;const a=this.tabs.findIndex(i=>c(i)===c(t));if(a===-1){const i=Q.tabbar.maxCount,b=(n=(s=t==null?void 0:t.meta)==null?void 0:s.maxNumOfOpenTab)!=null?n:-1;if(b>0&&this.tabs.filter(h=>h.name===t.name).length>=b){const h=this.tabs.findIndex(l=>l.name===t.name);h!==-1&&this.tabs.splice(h,1)}else if(i>0&&this.tabs.length>=i){const h=this.tabs.findIndex(l=>!Reflect.has(l.meta,"affixTab")||!l.meta.affixTab);h!==-1&&this.tabs.splice(h,1)}this.tabs.push(e)}else{const i=X(this.tabs)[a],b=x(T(T({},i),e),{meta:T(T({},i==null?void 0:i.meta),e.meta)});if(i){const h=i.meta;Reflect.has(h,"affixTab")&&(b.meta.affixTab=h.affixTab),Reflect.has(h,"newTabTitle")&&(b.meta.newTabTitle=h.newTabTitle)}this.tabs.splice(a,1,b)}this.updateCacheTabs()},closeAllTabs(t){return o(this,null,function*(){const e=this.tabs.filter(a=>r(a));this.tabs=e.length>0?e:[...this.tabs].splice(0,1),yield this._goToDefaultTab(t),this.updateCacheTabs()})},closeLeftTabs(t){return o(this,null,function*(){const e=this.tabs.findIndex(n=>c(n)===c(t));if(e<1)return;const a=this.tabs.slice(0,e),s=[];for(const n of a)r(n)||s.push(c(n));yield this._bulkCloseByPaths(s)})},closeOtherTabs(t){return o(this,null,function*(){const e=this.tabs.map(s=>c(s)),a=[];for(const s of e)if(s!==t.fullPath){const n=this.tabs.find(i=>c(i)===s);if(!n)continue;r(n)||a.push(c(n))}yield this._bulkCloseByPaths(a)})},closeRightTabs(t){return o(this,null,function*(){const e=this.tabs.findIndex(a=>c(a)===c(t));if(e!==-1&&e<this.tabs.length-1){const a=this.tabs.slice(e+1),s=[];for(const n of a)r(n)||s.push(c(n));yield this._bulkCloseByPaths(s)}})},closeTab(t,e){return o(this,null,function*(){const{currentRoute:a}=e;if(c(a.value)!==c(t)){this._close(t),this.updateCacheTabs();return}const s=this.getTabs.findIndex(b=>c(b)===c(a.value)),n=this.getTabs[s-1],i=this.getTabs[s+1];i?(this._close(t),yield this._goToTab(i,e)):n?(this._close(t),yield this._goToTab(n,e)):console.error("Failed to close the tab; only one tab remains open.")})},closeTabByKey(t,e){return o(this,null,function*(){const a=decodeURIComponent(t),s=this.tabs.findIndex(i=>c(i)===a);if(s===-1)return;const n=this.tabs[s];n&&(yield this.closeTab(n,e))})},getTabByPath(t){return this.getTabs.find(e=>c(e)===t)},openTabInNewWindow(t){return o(this,null,function*(){J(t.fullPath||t.path)})},pinTab(t){return o(this,null,function*(){var n;const e=this.tabs.findIndex(i=>c(i)===c(t));if(e!==-1){const i=this.tabs[e];t.meta.affixTab=!0,t.meta.title=(n=i==null?void 0:i.meta)==null?void 0:n.title,this.tabs.splice(e,1,t)}const s=this.tabs.filter(i=>r(i)).findIndex(i=>c(i)===c(t));yield this.sortTabs(e,s)})},refresh(t){return o(this,null,function*(){if(typeof t=="string")return yield this.refreshByName(t);const{currentRoute:e}=t,{name:a}=e.value;this.excludeCachedTabs.add(a),this.renderRouteView=!1,j(),yield new Promise(s=>setTimeout(s,200)),this.excludeCachedTabs.delete(a),this.renderRouteView=!0,H()})},refreshByName(t){return o(this,null,function*(){this.excludeCachedTabs.add(t),yield new Promise(e=>setTimeout(e,200)),this.excludeCachedTabs.delete(t)})},resetTabTitle(t){return o(this,null,function*(){var a;if((a=t==null?void 0:t.meta)!=null&&a.newTabTitle)return;const e=this.tabs.find(s=>c(s)===c(t));e&&(e.meta.newTabTitle=void 0,yield this.updateCacheTabs())})},setAffixTabs(t){for(const e of t)e.meta.affixTab=!0,this.addTab(tt(e))},setMenuList(t){this.menuList=t},setTabTitle(t,e){return o(this,null,function*(){const a=this.tabs.find(s=>c(s)===c(t));a&&(a.meta.newTabTitle=e,yield this.updateCacheTabs())})},setUpdateTime(){this.updateTime=Date.now()},sortTabs(t,e){return o(this,null,function*(){const a=this.tabs[t];a&&(this.tabs.splice(t,1),this.tabs.splice(e,0,a),this.dragEndIndex=this.dragEndIndex+1)})},toggleTabPin(t){return o(this,null,function*(){var a,s;yield((s=(a=t==null?void 0:t.meta)==null?void 0:a.affixTab)!=null?s:!1)?this.unpinTab(t):this.pinTab(t)})},unpinTab(t){return o(this,null,function*(){var n;const e=this.tabs.findIndex(i=>c(i)===c(t));if(e!==-1){const i=this.tabs[e];t.meta.affixTab=!1,t.meta.title=(n=i==null?void 0:i.meta)==null?void 0:n.title,this.tabs.splice(e,1,t)}const s=this.tabs.filter(i=>r(i)).length;yield this.sortTabs(e,s)})},updateCacheTabs(){return o(this,null,function*(){var e;const t=new Set;for(const a of this.tabs){if(!((e=a.meta)==null?void 0:e.keepAlive))continue;(a.matched||[]).forEach((i,b)=>{b>0&&t.add(i.name)});const n=a.name;t.add(n)}this.cachedTabs=t})}},getters:{affixTabs(){return this.tabs.filter(e=>r(e)).sort((e,a)=>{var i,b,h,l;const s=(b=(i=e.meta)==null?void 0:i.affixTabOrder)!=null?b:0,n=(l=(h=a.meta)==null?void 0:h.affixTabOrder)!=null?l:0;return s-n})},getCachedTabs(){return[...this.cachedTabs]},getExcludeCachedTabs(){return[...this.excludeCachedTabs]},getMenuList(){return this.menuList},getTabs(){const t=this.tabs.filter(e=>!r(e));return[...this.affixTabs,...t].filter(Boolean)}},persist:[{pick:["tabs"],storage:sessionStorage}],state:()=>({cachedTabs:new Set,dragEndIndex:0,excludeCachedTabs:new Set,menuList:["close","affix","maximize","reload","open-in-new-window","close-left","close-right","close-other","close-all"],renderRouteView:!0,tabs:[],updateTime:Date.now()})});function Z(t){if(!t)return t;const n=t,{matched:e,meta:a}=n,s=B(n,["matched","meta"]);return x(T({},s),{matched:e?e.map(i=>({meta:i.meta,name:i.name,path:i.path})):void 0,meta:x(T({},a),{newTabTitle:a.newTabTitle})})}function r(t){var e,a;return(a=(e=t==null?void 0:t.meta)==null?void 0:e.affixTab)!=null?a:!1}function $(t){var a;const e=(a=t==null?void 0:t.matched)!=null?a:[];return!t.meta.hideInTab&&e.every(s=>!s.meta.hideInTab)}function c(t){return decodeURIComponent(t.fullPath||t.path)}function tt(t){return{meta:t.meta,name:t.name,path:t.path}}function it(){const t=F(),e=G(),a=Y();function s(f){return o(this,null,function*(){yield a.closeLeftTabs(f||e)})}function n(){return o(this,null,function*(){yield a.closeAllTabs(t)})}function i(f){return o(this,null,function*(){yield a.closeRightTabs(f||e)})}function b(f){return o(this,null,function*(){yield a.closeOtherTabs(f||e)})}function h(f){return o(this,null,function*(){yield a.closeTab(f||e,t)})}function l(f){return o(this,null,function*(){yield a.pinTab(f||e)})}function d(f){return o(this,null,function*(){yield a.unpinTab(f||e)})}function A(f){return o(this,null,function*(){yield a.toggleTabPin(f||e)})}function O(f){return o(this,null,function*(){yield a.refresh(f||t)})}function v(f){return o(this,null,function*(){yield a.openTabInNewWindow(f||e)})}function L(f){return o(this,null,function*(){yield a.closeTabByKey(f,t)})}function S(f){return o(this,null,function*(){a.setUpdateTime(),yield a.setTabTitle(e,f)})}function k(){return o(this,null,function*(){a.setUpdateTime(),yield a.resetTabTitle(e)})}function N(f=e){var I;const u=a.getTabs,C=a.affixTabs,w=u.findIndex(M=>M.path===f.path),g=u.length<=1,{meta:y}=f,D=(I=y==null?void 0:y.affixTab)!=null?I:!1,m=e.path===f.path,E=w===0||w-C.length<=0||!m,U=!m||w===u.length-1,K=g||!m||u.length-C.length<=1;return{disabledCloseAll:g,disabledCloseCurrent:!!D||g,disabledCloseLeft:E,disabledCloseOther:K,disabledCloseRight:U,disabledRefresh:!m}}return{closeAllTabs:n,closeCurrentTab:h,closeLeftTabs:s,closeOtherTabs:b,closeRightTabs:i,closeTabByKey:L,getTabDisableState:N,openTabInNewWindow:v,pinTab:l,refreshTab:O,resetTabTitle:k,setTabTitle:S,toggleTabPin:A,unpinTab:d}}export{Y as a,it as u};
