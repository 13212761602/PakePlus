var Pe=Object.defineProperty,Be=Object.defineProperties;var $e=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var J=(n,t,s)=>t in n?Pe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,g=(n,t)=>{for(var s in t||(t={}))Fe.call(t,s)&&J(n,s,t[s]);if(ue)for(var s of ue(t))Le.call(t,s)&&J(n,s,t[s]);return n},N=(n,t)=>Be(n,$e(t));var O=(n,t,s)=>J(n,typeof t!="symbol"?t+"":t,s);var B=(n,t,s)=>new Promise((v,d)=>{var V=i=>{try{x(s.next(i))}catch(P){d(P)}},$=i=>{try{x(s.throw(i))}catch(P){d(P)}},x=i=>i.done?v(i.value):Promise.resolve(i.value).then(V,$);x((s=s.apply(n,t)).next())});import{am as T,an as Re,ao as Ee,A as k,K as Ge,ap as be,d as ve,E as Ae,B as h,a5 as He,aq as _e,S as K,q as ze,v as Me,y as Ne,c as X,o as A,a as q,a6 as ce,w as m,O as de,r as f,f as H,j as me,k as fe,h as pe,t as Q,b as r,e as S,g as C,W as qe,n as ge,G as Y,H as je,R as De,ar as Ie,I as Ue,ah as We,M as Je}from"../jse/index-index-CKHiV3bJ.js";import{S as Ke,_ as Xe,u as Qe}from"./index-C0ExvxMt.js";import{ck as Ye,cl as Ze,$ as _,cm as et,cn as tt,at as ot}from"./bootstrap-CbEyMBZc.js";import{u as st,V as he,a as at,b as rt,e as nt}from"./init-5GXIIGpx.js";function it(){return{class:"",gridClass:"",gridOptions:{},gridEvents:{},formOptions:void 0,showSearchForm:!0}}class lt{constructor(t={}){O(this,"isMounted",!1);O(this,"stateHandler");O(this,"formApi",{});O(this,"grid",{});O(this,"state",null);O(this,"store");const s=g({},t),v=it();this.store=new Ke(T(s,v),{onUpdate:()=>{this.state=this.store.state}}),this.state=this.store.state,this.stateHandler=new Re,Ee(this)}mount(t,s){!this.isMounted&&t&&(this.grid=t,this.formApi=s,this.stateHandler.setConditionTrue(),this.isMounted=!0)}query(){return B(this,arguments,function*(t={}){try{yield this.grid.commitProxy("query",k(t))}catch(s){console.error("Error occurred while querying:",s)}})}reload(){return B(this,arguments,function*(t={}){try{yield this.grid.commitProxy("reload",k(t))}catch(s){console.error("Error occurred while reloading:",s)}})}setGridOptions(t){this.setState({gridOptions:t})}setLoading(t){this.setState({gridOptions:{loading:t}})}setState(t){Ge(t)?this.store.setState(s=>T(t(s),s)):this.store.setState(s=>T(t,s))}toggleSearchForm(t){var s,v;return this.setState({showSearchForm:be(t)?t:!((s=this.state)!=null&&s.showSearchForm)}),(v=this.state)==null?void 0:v.showSearchForm}unmount(){this.isMounted=!1,this.stateHandler.reset()}}const ut={class:"mr-1 pl-1 text-[1rem]"},ct={class:"mt-2"},Z="form-",j="toolbar-actions",D="toolbar-tools",dt=ve({__name:"use-vxe-grid",props:{api:{},tableTitle:{},tableTitleHelp:{},class:{},gridClass:{},gridOptions:{},gridEvents:{},formOptions:{},showSearchForm:{type:Boolean},separator:{type:[Boolean,Object]}},setup(n){var z,ae;const t=n,s=Ae("gridRef"),v=(ae=(z=t.api)==null?void 0:z.useStore)==null?void 0:ae.call(z),{gridOptions:d,class:V,gridClass:$,gridEvents:x,formOptions:i,tableTitle:P,tableTitleHelp:ee,showSearchForm:F,separator:y}=Ye(t,v),{isMobile:ye}=Ze(),I=h(()=>!i.value||F.value===!1||y.value===!1?!1:y.value===!0||y.value===void 0?!0:y.value.show!==!1),te=h(()=>!y.value||be(y.value)||!y.value.backgroundColor?void 0:y.value.backgroundColor),l=He(),[Se,c]=st({compact:!0,handleSubmit:()=>B(null,null,function*(){const e=yield c.getValues();c.setLatestSubmissionValues(k(e)),t.api.reload(e)}),handleReset:()=>B(null,null,function*(){var a;const e=yield c.getValues();yield c.resetForm();const o=yield c.getValues();c.setLatestSubmissionValues(o),(_e(e,o)||!((a=i.value)!=null&&a.submitOnChange))&&t.api.reload(o)}),commonConfig:{componentProps:{class:"w-full"}},showCollapseButton:!0,submitButtonOptions:{content:h(()=>_("common.search"))},submitOnEnter:!0,wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}),U=h(()=>{var e;return!!((e=l.tableTitle)!=null&&e.call(l))||P.value}),W=h(()=>{var e,o;return!!((e=l[j])!=null&&e.call(l))||!!((o=l[D])!=null&&o.call(l))||U.value}),Ce=h(()=>{var p,b,w,L,R,E,G;const e=(p=l[j])==null?void 0:p.call(l),o=(b=l[D])==null?void 0:b.call(l),a={code:"search",icon:"vxe-icon-search",circle:!0,status:F.value?"primary":void 0,title:F.value?_("common.hideSearchPanel"):_("common.showSearchPanel")},u={tools:(R=(L=(w=d.value)==null?void 0:w.toolbarConfig)==null?void 0:L.tools)!=null?R:[]};return(G=(E=d.value)==null?void 0:E.toolbarConfig)!=null&&G.search&&i.value&&(u.tools=Array.isArray(u.tools)?[...u.tools,a]:[a]),W.value?(u.slots=g(g({},e||U.value?{buttons:j}:{}),o?{tools:D}:{}),{toolbarConfig:u}):{toolbarConfig:u}}),oe=h(()=>{var a,u,p;const e=(p=(u=(a=he)==null?void 0:a.getConfig())==null?void 0:u.grid)!=null?p:{},o=K(T({},k(Ce.value),k(d.value),e));if(o.proxyConfig){const{ajax:b}=o.proxyConfig;o.proxyConfig.enabled=!!b,o.proxyConfig.autoLoad=!1}if(o.pagerConfig){const b=["PrevJump","PrevPage","Number","NextPage","NextJump"],w=["Total","Sizes","Home",...b,"End"];o.pagerConfig=T({},o.pagerConfig,{pageSize:20,background:!0,pageSizes:[10,20,30,50,100,200],className:"mt-2 w-full",layouts:ye.value?b:w,size:"mini"})}return o.formConfig&&(o.formConfig.enabled=!1),o});function we(e){var o,a;e.code==="search"&&se(),(a=(o=x.value)==null?void 0:o.toolbarToolClick)==null||a.call(o,e)}function se(){var e,o;(o=(e=t.api)==null?void 0:e.toggleSearchForm)==null||o.call(e)}const Oe=h(()=>N(g({},x.value),{toolbarToolClick:we})),ke=h(()=>{const e=[];for(const o of Object.keys(l))["empty","form","loading",j,D].includes(o)||e.push(o);return e}),Te=h(()=>{const e=[];for(const o of Object.keys(l))o.startsWith(Z)&&e.push(o);return e.map(o=>o.replace(Z,""))});function Ve(){return B(this,null,function*(){var b,w,L,R,E,G,re,ne,ie,M,le;yield Ue();const e=(L=(w=(b=he)==null?void 0:b.getConfig())==null?void 0:w.grid)!=null?L:{},o=T({},k(d.value),k(e)),a=(R=o.proxyConfig)==null?void 0:R.autoLoad;((E=oe.value.proxyConfig)==null?void 0:E.enabled)&&a&&((ne=(re=t.api.grid).commitProxy)==null||ne.call(re,"_init",K(i.value)?(G=K(yield c.getValues()))!=null?G:{}:{}));const p=(ie=d.value)==null?void 0:ie.formConfig;p&&p.enabled&&console.warn("[Vben Vxe Table]: The formConfig in the grid is not supported, please use the `formOptions` props"),(le=(M=t.api)==null?void 0:M.setState)==null||le.call(M,{gridOptions:o}),nt(t.api,o,()=>c.getLatestSubmissionValues())})}ze(i,()=>{c.setState(e=>{const o=T({},i.value,e);return N(g({},o),{collapseTriggerResize:!!o.showCollapseButton})})},{immediate:!0});const xe=h(()=>{var e;return(e=c.getState())==null?void 0:e.compact});return Me(()=>{var e,o;(o=(e=t.api)==null?void 0:e.mount)==null||o.call(e,s.value,c),Ve()}),Ne(()=>{var e,o,a;(e=c==null?void 0:c.unmount)==null||e.call(c),(a=(o=t.api)==null?void 0:o.unmount)==null||a.call(o)}),(e,o)=>(A(),X("div",{class:ge(r(Y)("bg-card h-full rounded-md",r(V)))},[q(r(rt),De({ref_key:"gridRef",ref:s,class:r(Y)("p-2",{"pt-0":W.value&&!r(i)},r($))},oe.value,Ie(Oe.value)),ce({"toolbar-tools":m(a=>{var u,p;return[f(e.$slots,"toolbar-tools",S(C(a))),(p=(u=r(d))==null?void 0:u.toolbarConfig)!=null&&p.search&&r(i)?(A(),pe(r(at),{key:0,icon:"vxe-icon-search",circle:"",class:"ml-2",status:r(F)?"primary":void 0,title:r(_)("common.search"),onClick:se},null,8,["status","title"])):H("",!0)]}),form:m(()=>[r(i)?qe((A(),X("div",{key:0,class:ge(r(Y)("relative rounded py-3",xe.value?I.value?"pb-8":"pb-4":I.value?"pb-4":"pb-0"))},[f(e.$slots,"form",{},()=>[q(r(Se),null,ce({"reset-before":m(a=>[f(e.$slots,"reset-before",S(C(a)))]),"submit-before":m(a=>[f(e.$slots,"submit-before",S(C(a)))]),"expand-before":m(a=>[f(e.$slots,"expand-before",S(C(a)))]),"expand-after":m(a=>[f(e.$slots,"expand-after",S(C(a)))]),_:2},[de(Te.value,a=>({name:a,fn:m(u=>[f(e.$slots,`${Z}${a}`,S(C(u)))])}))]),1024)]),I.value?(A(),X("div",{key:0,style:je(g({},te.value?{backgroundColor:te.value}:void 0)),class:"bg-background-deep z-100 absolute -left-2 bottom-1 h-2 w-[calc(100%+1rem)] overflow-hidden md:bottom-2 md:h-3"},null,4)):H("",!0)],2)),[[ot,r(F)!==!1]]):H("",!0)]),loading:m(()=>[f(e.$slots,"loading",{},()=>[q(r(tt),{spinning:!0})])]),empty:m(()=>[f(e.$slots,"empty",{},()=>[q(r(et),{class:"mx-auto"}),me("div",ct,Q(r(_)("common.noData")),1)])]),_:2},[W.value?{name:"toolbar-actions",fn:m(a=>[U.value?f(e.$slots,"table-title",{key:0},()=>[me("div",ut,[fe(Q(r(P))+" ",1),r(ee)?(A(),pe(r(Xe),{key:0,"trigger-class":"pb-1"},{default:m(()=>[fe(Q(r(ee)),1)]),_:1})):H("",!0)])]):H("",!0),f(e.$slots,"toolbar-actions",S(C(a)))]),key:"0"}:void 0,de(ke.value,a=>({name:a,fn:m(u=>[f(e.$slots,a,S(C(u)))])}))]),1040,["class"])],2))}});function bt(n){const t=new lt(n),s=t;return s.useStore=d=>Qe(t.store,d),[ve((d,{attrs:V,slots:$})=>(We(()=>{t.unmount()}),t.setState(g(g({},d),V)),()=>Je(dt,N(g(g({},d),V),{api:s}),$)),{name:"VbenVxeGrid",inheritAttrs:!1}),s]}export{bt as u};
