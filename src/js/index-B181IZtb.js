var Z=Object.defineProperty;var z=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var A=(u,o,r)=>o in u?Z(u,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[o]=r,N=(u,o)=>{for(var r in o||(o={}))ee.call(o,r)&&A(u,r,o[r]);if(z)for(var r of z(o))te.call(o,r)&&A(u,r,o[r]);return u};var p=(u,o,r)=>new Promise((b,w)=>{var s=m=>{try{c(r.next(m))}catch(y){w(y)}},x=m=>{try{c(r.throw(m))}catch(y){w(y)}},c=m=>m.done?b(m.value):Promise.resolve(m.value).then(s,x);c((r=r.apply(u,o)).next())});import{aG as oe,aq as ie,$ as D,al as ae,an as S}from"./bootstrap-CbEyMBZc.js";import{v as ne}from"./vxe-table-5UTMlFMN.js";import{a as le,u as re,b as M,c as se,d as de,e as pe,f as ce}from"./index-BCeYPciK.js";import{d as ue}from"./download-BL_xY_mD.js";import{_ as me}from"./category-tree.vue_vue_type_script_setup_true_lang-Dm1xCFWN.js";import{c as fe,q as ge,_ as ye}from"./process-definition-modal.vue_vue_type_script_setup_true_lang-FNfmd-0H.js";import{_ as ve}from"./process-definition-deploy-modal.vue_vue_type_script_setup_true_lang-BU8mitKz.js";import he from"./index-Yd03BW_o.js";import{_ as Ce}from"./page.vue_vue_type_script_setup_true_lang-C6V6VPKH.js";import{d as ke,p as B,B as we,l as _e,V as be,h,o as C,w as l,j as k,a as d,b as n,k as g,t as $,f as xe,W as P}from"../jse/index-index-CKHiV3bJ.js";import{u as De}from"./use-vxe-grid-jJsowVf7.js";import{u as L}from"./use-modal-BtBQhM0d.js";import{P as q}from"./index-Bf3KtG2n.js";import{g as R}from"./get-popup-container-P4S1sr5h.js";import Se from"./index-CzyoVQCf.js";import{a as $e}from"./Group-u_j2Tbqv.js";import"./form-DcAycvJX.js";import"./use-vben-form-CDDuv56b.js";import"./index-C0ExvxMt.js";import"./checkbox.vue_vue_type_script_setup_true_lang-53DrAgf8.js";import"./render-content.vue_vue_type_script_lang-h-IJYrAt.js";import"./init-5GXIIGpx.js";import"./index-CUsW12bK.js";import"./css-Dmgy8YJo.js";import"./LeftOutlined-D2uSfO0F.js";import"./index-B9jrj9-y.js";import"./SyncOutlined-CaKwXa3d.js";import"./index-Bn5n5c2e.js";import"./Search-BSSOOXXu.js";import"./statusUtils-BVmAuBuf.js";import"./BaseInput-B-KbMaIq.js";import"./index-CWS-moKy.js";import"./SearchOutlined-wPvswOvm.js";import"./index-DcmIf06E.js";import"./index-C2Ye5jbl.js";import"./List-CkKZPkf7.js";import"./index-B4Ee8RY3.js";import"./eagerComputed-ClTeoNNc.js";import"./index-CKqqy29x.js";import"./popup-DepLi2Z4.js";import"./vuedraggable.umd-Cwsj9bYW.js";import"./options-tag.vue_vue_type_script_setup_true_lang-ixeCQrr7.js";import"./index-D7oCs85i.js";import"./constant-CNx795op.js";import"./tree-DFBawhPd.js";import"./index-cCfXrJ1Q.js";import"./index-BLUHc0Mr.js";import"./x-C_lPlK2i.js";import"./index-7E7RpNGb.js";import"./Checkbox-CpVw4yVS.js";const Pe={class:"flex h-full gap-[8px]"},qe={class:"flex flex-col gap-1"},$t=ke({__name:"index",setup(u){const o=B([]),r={schema:ge(),commonConfig:{labelWidth:80,componentProps:{allowClear:!0}},wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",handleReset:()=>p(null,null,function*(){o.value=[];const{formApi:t,reload:e}=s;yield t.resetForm();const i=t.form.values;t.setLatestSubmissionValues(i),yield e(i)})},b={checkboxConfig:{highlight:!0,reserve:!0,trigger:"default"},columns:fe,height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(i,...v)=>p(null,[i,...v],function*({page:t},e={}){return o.value.length===1?e.category=o.value[0]:Reflect.deleteProperty(e,"category"),yield m.value(N({pageNum:t.currentPage,pageSize:t.pageSize},e))})}},headerCellConfig:{height:44},cellConfig:{height:100},rowConfig:{keyField:"id"},id:"workflow-definition-index"},[w,s]=De({formOptions:r,gridOptions:b}),x=[{label:"已发布流程",value:1},{label:"未发布流程",value:0}],c=B(1),m=we(()=>c.value===1?le:re);function y(t){return p(this,null,function*(){c.value=t.target.value,yield s.reload()})}function O(t){return p(this,null,function*(){yield M(t.id),yield s.query()})}function T(){const e=s.grid.getCheckboxRecords().map(i=>i.id);ae.confirm({title:"提示",okType:"danger",content:`确认删除选中的${e.length}条记录吗？`,onOk:()=>p(null,null,function*(){yield M(e),yield s.query()})})}const U=oe();function j(t,e){U.push({path:"/workflow/designer",query:{definitionId:t.id,disabled:String(e)}})}function E(t,e){return p(this,null,function*(){const i=e===1?0:1;try{yield se(t.id,!!e),yield s.query()}catch(v){t.activityStatus=i,console.error(v)}})}function G(t){return p(this,null,function*(){yield de(t.id),yield s.query()})}function F(t){return p(this,null,function*(){yield pe(t.id),c.value=0,yield s.reload()})}const[W,_]=L({connectedComponent:ye});function I(){_.setData({}),_.open()}function X(t){_.setData({id:t.id}),_.open()}function H(t){return p(this,null,function*(){const e=S.loading(D("pages.common.downloadLoading"),0);try{const i=yield ce(t.id);ue(i,`${t.flowName}-${Date.now()}.json`)}catch(i){console.error(i)}finally{e()}})}const[J,V]=L({connectedComponent:ve});function K(){if(o.value.length===0){S.warning("请先选择流程分类");return}const t=o.value[0];if(t===0){S.warning("不可选择根目录进行部署, 请选择子分类");return}V.setData({category:t}),V.open()}function Q(){return p(this,null,function*(){c.value=0,yield s.reload()})}function Y(t){return p(this,null,function*(){t==="add"&&(c.value=0),yield s.reload()})}return(t,e)=>{const i=_e("a-button"),v=be("access");return C(),h(n(Ce),{"auto-content-height":!0},{default:l(()=>[k("div",Pe,[d(me,{"select-code":o.value,"onUpdate:selectCode":e[0]||(e[0]=a=>o.value=a),class:"w-[260px]",onReload:e[1]||(e[1]=()=>n(s).reload()),onSelect:e[2]||(e[2]=()=>n(s).reload())},null,8,["select-code"]),d(n(w),{class:"flex-1 overflow-hidden"},{"toolbar-actions":l(()=>[d(n($e),{value:c.value,"onUpdate:value":e[3]||(e[3]=a=>c.value=a),options:x,"button-style":"solid","option-type":"button",onChange:y},null,8,["value"])]),"toolbar-tools":l(()=>[d(n(he),null,{default:l(()=>[P((C(),h(i,{disabled:!n(ne)(n(s)),danger:"",type:"primary",onClick:T},{default:l(()=>[g($(n(D)("pages.common.delete")),1)]),_:1},8,["disabled"])),[[v,["system:user:remove"],"code"]]),P((C(),h(i,{onClick:K},{default:l(()=>e[5]||(e[5]=[g(" 部署 ")])),_:1,__:[5]})),[[v,["system:user:add"],"code"]]),P((C(),h(i,{type:"primary",onClick:I},{default:l(()=>[g($(n(D)("pages.common.add")),1)]),_:1})),[[v,["system:user:add"],"code"]])]),_:1})]),activityStatus:l(({row:a})=>[d(n(Se),{checked:a.activityStatus,"onUpdate:checked":f=>a.activityStatus=f,"checked-value":1,"unchecked-value":0,"checked-children":"激活","un-checked-children":"挂起",onChange:f=>E(a,f)},null,8,["checked","onUpdate:checked","onChange"])]),action:l(({row:a})=>[k("div",qe,[k("div",null,[d(i,{size:"small",type:"link",onClick:f=>X(a)},{default:l(()=>e[6]||(e[6]=[g(" 编辑信息 ")])),_:2,__:[6]},1032,["onClick"]),d(n(q),{"get-popup-container":n(R),placement:"left",title:"确认删除？",onConfirm:f=>O(a)},{default:l(()=>[d(i,{danger:"",size:"small",type:"link",onClick:e[4]||(e[4]=ie(()=>{},["stop"]))},{default:l(()=>e[7]||(e[7]=[g(" 删除流程 ")])),_:1,__:[7]})]),_:2},1032,["get-popup-container","onConfirm"])]),k("div",null,[d(i,{size:"small",type:"link",onClick:f=>j(a,!!a.isPublish)},{default:l(()=>[g($(a.isPublish?"查看流程":"设计流程"),1)]),_:2},1032,["onClick"]),d(n(q),{"get-popup-container":n(R),title:`确认发布流程[${a.flowName}]?`,placement:"left",onConfirm:f=>G(a)},{default:l(()=>[a.isPublish?xe("",!0):(C(),h(i,{key:0,size:"small",type:"link"},{default:l(()=>e[8]||(e[8]=[g(" 发布流程 ")])),_:1,__:[8]}))]),_:2},1032,["get-popup-container","title","onConfirm"])]),k("div",null,[d(n(q),{"get-popup-container":n(R),title:`确认复制流程[${a.flowName}]?`,placement:"left",onConfirm:f=>F(a)},{default:l(()=>[d(i,{size:"small",type:"link"},{default:l(()=>e[9]||(e[9]=[g(" 复制流程 ")])),_:1,__:[9]})]),_:2},1032,["get-popup-container","title","onConfirm"]),d(i,{size:"small",type:"link",onClick:f=>H(a)},{default:l(()=>e[10]||(e[10]=[g(" 导出流程 ")])),_:2,__:[10]},1032,["onClick"])])])]),_:1})]),d(n(W),{onReload:Y}),d(n(J),{onReload:Q})]),_:1})}}});export{$t as default};
