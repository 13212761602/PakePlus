var m=(i,n,o)=>new Promise((s,f)=>{var u=t=>{try{d(o.next(t))}catch(c){f(c)}},e=t=>{try{d(o.throw(t))}catch(c){f(c)}},d=t=>t.done?s(t.value):Promise.resolve(t.value).then(u,e);d((o=o.apply(i,n)).next())});import{$ as h}from"./bootstrap-CbEyMBZc.js";import{u as v}from"./form-DcAycvJX.js";import{c as I}from"./index-B9jrj9-y.js";import{g as D,h as S,i as k}from"./index-BCeYPciK.js";import{u as V,d as w}from"./popup-DepLi2Z4.js";import"./vuedraggable.umd-Cwsj9bYW.js";import{_ as x}from"./options-tag.vue_vue_type_script_setup_true_lang-ixeCQrr7.js";import{p as B}from"./constant-CNx795op.js";import{a as g,d as P,p as F,B as q,S as W,h as A,o as L,w as z,j as $,b}from"../jse/index-index-CKHiV3bJ.js";import{u as G}from"./use-modal-BtBQhM0d.js";import{a as O}from"./tree-DFBawhPd.js";import{a as T}from"./get-popup-container-P4S1sr5h.js";const oe=()=>[{component:"Input",fieldName:"flowName",label:"流程名称"},{component:"Input",fieldName:"flowCode",label:"流程code"}],le=[{type:"checkbox",width:60},{field:"flowName",title:"流程名称",minWidth:150},{field:"flowCode",title:"流程code",minWidth:150},{field:"version",title:"版本号",minWidth:80,formatter:({cellValue:i})=>`V${i}.0`},{field:"activityStatus",title:"激活状态",minWidth:100,slots:{default:"activityStatus"}},{field:"isPublish",title:"发布状态",minWidth:100,slots:{default:({row:i})=>{const n=i.isPublish;return g(x,{options:B,value:n},null)}}},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",resizable:!1,width:"auto"}],U=()=>[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"id"},{component:"TreeSelect",fieldName:"category",label:"流程分类",rules:"selectRequired"},{component:"Input",fieldName:"flowCode",label:"流程code",rules:"required"},{component:"Input",fieldName:"flowName",label:"流程名称",rules:"required"},{component:"Input",fieldName:"formPath",label:"表单路径",rules:"required"}],j={class:"min-h-[400px]"},ie=P({__name:"process-definition-modal",emits:["reload"],setup(i,{emit:n}){const o=n,s=F(!1),f=q(()=>s.value?h("pages.common.edit"):h("pages.common.add")),[u,e]=v({commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-2",labelWidth:90},schema:U(),showDefaultActions:!1,wrapperClass:"grid-cols-2"});function d(){return m(this,null,function*(){const a=yield I();O(a,"label"," / "),e.updateSchema([{componentProps:{fieldNames:{label:"label",value:"id"},getPopupContainer:T,listHeight:300,showSearch:!0,treeData:a,treeDefaultExpandAll:!0,treeLine:{showLeafIcon:!1},treeNodeFilterProp:"label",treeNodeLabelProp:"fullName"},fieldName:"category"}])})}const{onBeforeClose:t,markInitialized:c,resetInitialized:p}=V({initializedGetter:w(e),currentGetter:w(e)}),[N,r]=G({onBeforeClose:t,onClosed:_,onConfirm:C,onOpenChange(a){return m(this,null,function*(){if(!a)return null;r.modalLoading(!0);const{id:l}=r.getData();if(s.value=!!l,yield d(),s.value&&l){const y=yield D(l);yield e.setValues(y)}yield c(),r.modalLoading(!1)})}});function C(){return m(this,null,function*(){try{r.lock(!0);const{valid:a}=yield e.validate();if(!a)return;const l=W(yield e.getValues());s.value?(yield S(l),o("reload","update")):(yield k(l),o("reload","add")),p(),r.close()}catch(a){console.error(a)}finally{r.lock(!1)}})}function _(){return m(this,null,function*(){yield e.resetForm(),p()})}return(a,l)=>(L(),A(b(N),{"fullscreen-button":!1,title:f.value,class:"w-[550px]"},{default:z(()=>[$("div",j,[g(b(u))])]),_:1},8,["title"]))}});export{ie as _,le as c,oe as q};
