var d=(_,C,l)=>new Promise((c,f)=>{var y=r=>{try{n(l.next(r))}catch(i){f(i)}},s=r=>{try{n(l.throw(r))}catch(i){f(i)}},n=r=>r.done?c(r.value):Promise.resolve(r.value).then(y,s);n((l=l.apply(_,C)).next())});import{$ as w}from"./bootstrap-CbEyMBZc.js";import{u as A}from"./form-DcAycvJX.js";import{r as G,m as z}from"./index-B7PFKwMa.js";import{r as K,a as U,b as j}from"./index-BT9g_NIp.js";import{M as L}from"./menu-select-table-BHgG0Yrw.js";import{u as N,d as O}from"./popup-DepLi2Z4.js";import{d as R}from"./data-cax7S9lw.js";import{d as $,p as v,B as P,S as q,h as E,o as H,w as S,a as I,b as h,j as J,I as V}from"../jse/index-index-CKHiV3bJ.js";import{u as Q}from"./use-drawer-ZsTa9Rf6.js";import{e as b}from"./tree-DFBawhPd.js";const W={class:"h-[600px] w-full"},ce=$({__name:"role-drawer",emits:["reload"],setup(_,{emit:C}){const l=C,c=v(!1),f=P(()=>c.value?w("pages.common.edit"):w("pages.common.add")),[y,s]=A({commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-1"},layout:"vertical",schema:R(),showDefaultActions:!1,wrapperClass:"grid-cols-2 gap-x-4"}),n=v([]);function r(a){return d(this,null,function*(){if(a){const e=yield G(a),t=e.menus;b(t,o=>{o.label=w(o.label)}),n.value=e.menus,yield V(),yield s.setFieldValue("menuIds",e.checkedKeys)}else{const e=yield z();b(e,t=>{t.label=w(t.label)}),n.value=e,yield V(),yield s.setFieldValue("menuIds",[])}})}function i(){return d(this,null,function*(){var o,p,m;const a=yield O(s)(),e=(m=(p=(o=k.value)==null?void 0:o.getCheckedKeys)==null?void 0:p.call(o))!=null?m:[];return a+e.join(",")})}const{onBeforeClose:x,markInitialized:B,resetInitialized:g}=N({initializedGetter:i,currentGetter:i}),[F,u]=Q({onBeforeClose:x,onClosed:D,onConfirm:T,destroyOnClose:!0,onOpenChange(a){return d(this,null,function*(){if(!a)return null;u.drawerLoading(!0);const{id:e}=u.getData();if(c.value=!!e,c.value&&e){const t=yield K(e);yield s.setValues(t)}yield r(e),yield B(),u.drawerLoading(!1)})}}),k=v();function T(){return d(this,null,function*(){var a,e,t;try{u.lock(!0);const{valid:o}=yield s.validate();if(!o)return;const p=(t=(e=(a=k.value)==null?void 0:a.getCheckedKeys)==null?void 0:e.call(a))!=null?t:[],m=q(yield s.getValues());m.menuIds=p,yield c.value?U(m):j(m),l("reload"),g(),u.close()}catch(o){console.error(o)}finally{u.lock(!1)}})}function D(){return d(this,null,function*(){yield s.resetForm(),g()})}function M(a){s.setFieldValue("menuCheckStrictly",a)}return(a,e)=>(H(),E(h(F),{title:f.value,class:"w-[800px]"},{default:S(()=>[I(h(y),null,{menuIds:S(t=>[J("div",W,[I(h(L),{ref_key:"menuSelectRef",ref:k,"checked-keys":t.value,association:h(s).form.values.menuCheckStrictly,menus:n.value,"onUpdate:association":M},null,8,["checked-keys","association","menus"])])]),_:1})]),_:1},8,["title"]))}});export{ce as _};
