var l=(e,w,i)=>new Promise((d,f)=>{var N=n=>{try{c(i.next(n))}catch(u){f(u)}},o=n=>{try{c(i.throw(n))}catch(u){f(u)}},c=n=>n.done?d(n.value):Promise.resolve(n.value).then(N,o);c((i=i.apply(e,w)).next())});import{y as m,ap as g,$ as b}from"./bootstrap-CbEyMBZc.js";import{u as x}from"./form-DcAycvJX.js";import{l as F}from"./index-CoycSe17.js";import{u as T,d as y}from"./popup-DepLi2Z4.js";import{g as _}from"./dict-LWP2femj.js";import{r as V}from"./render-C2mFGEaj.js";import{a as h}from"./get-popup-container-P4S1sr5h.js";import{a as S,l as D}from"./use-vben-form-CDDuv56b.js";import{l as k,a as q}from"./tree-DFBawhPd.js";import{d as M,p as O,B as R,S as z,h as E,o as G,w as U,a as W,b as C}from"../jse/index-index-CKHiV3bJ.js";import{u as Y}from"./use-drawer-ZsTa9Rf6.js";function j(e){return m.get("/system/dept/list",{params:e})}function H(e){return m.get(`/system/dept/list/exclude/${e}`)}function J(e){return m.get(`/system/dept/${e}`)}function K(e){return m.postWithMsg("/system/dept",e)}function Q(e){return m.putWithMsg("/system/dept",e)}function me(e){return m.deleteWithMsg(`/system/dept/${e}`)}const ce=()=>[{component:"Input",fieldName:"deptName",label:"部门名称"},{component:"Select",componentProps:{getPopupContainer:h,options:_(g.SYS_NORMAL_DISABLE)},fieldName:"status",label:"部门状态"}],ue=[{field:"deptName",title:"部门名称",treeNode:!0,width:200},{field:"deptCategory",title:"类别编码"},{field:"orderNum",title:"排序",resizable:!1,width:"auto"},{field:"status",resizable:!1,width:"auto",title:"状态",slots:{default:({row:e})=>V(e.status,g.SYS_NORMAL_DISABLE)}},{field:"createTime",title:"创建时间"},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",width:200}],X=()=>[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"deptId"},{component:"TreeSelect",componentProps:{getPopupContainer:h},dependencies:{show:e=>e.parentId!==0,triggerFields:["parentId"]},fieldName:"parentId",label:"上级部门",rules:"selectRequired"},{component:"Input",fieldName:"deptName",label:"部门名称",rules:"required"},{component:"InputNumber",fieldName:"orderNum",label:"显示排序",rules:"required"},{component:"Input",fieldName:"deptCategory",label:"类别编码"},{component:"Select",componentProps:{allowClear:!1,getPopupContainer:h},fieldName:"leader",label:"负责人"},{component:"Input",fieldName:"phone",label:"联系电话",rules:S().regex(/^1[3,4578]\d{9}$/,{message:"请输入正确的手机号"}).optional().or(D(""))},{component:"Input",fieldName:"email",label:"邮箱",rules:S().email({message:"请输入正确的邮箱"}).optional().or(D(""))},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:_(g.SYS_NORMAL_DISABLE),optionType:"button"},defaultValue:"0",fieldName:"status",label:"状态"}],fe=M({__name:"dept-drawer",emits:["reload"],setup(e,{emit:w}){const i=w,d=O(!1),f=R(()=>d.value?b("pages.common.edit"):b("pages.common.add")),[N,o]=x({commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-2",labelWidth:80},schema:X(),showDefaultActions:!1,wrapperClass:"grid-cols-2"});function c(a,t=!1){return l(this,null,function*(){let s=[];s=yield!a||t?j({}):H(a);const r=k(s,{id:"deptId",pid:"parentId"});return q(r,"deptName"," / "),r})}function n(a){return l(this,null,function*(){const t=yield c(a,!d.value);o.updateSchema([{componentProps:{fieldNames:{label:"deptName",value:"deptId"},showSearch:!0,treeData:t,treeDefaultExpandAll:!0,treeLine:{showLeafIcon:!1},treeNodeLabelProp:"fullName"},fieldName:"parentId"}])})}function u(a){return l(this,null,function*(){const t=yield F(a),s=t.map(r=>({label:`${r.userName} | ${r.nickName}`,value:r.userId}));o.updateSchema([{componentProps:{disabled:t.length===0,options:s,placeholder:t.length===0?"该部门暂无用户":"请选择部门负责人"},fieldName:"leader"}])})}function L(){return l(this,null,function*(){o.updateSchema([{componentProps:{disabled:!0,options:[],placeholder:"仅在更新时可选部门负责人"},fieldName:"leader"}])})}const{onBeforeClose:A,markInitialized:B,resetInitialized:I}=T({initializedGetter:y(o),currentGetter:y(o)}),[$,p]=Y({onBeforeClose:A,onClosed:P,onConfirm:v,onOpenChange(a){return l(this,null,function*(){if(!a)return null;p.drawerLoading(!0);const{id:t,update:s}=p.getData();if(d.value=s,t&&(yield o.setFieldValue("parentId",t),s)){const r=yield J(t);yield o.setValues(r)}yield s&&t?u(t):L(),yield n(t),yield B(),p.drawerLoading(!1)})}});function v(){return l(this,null,function*(){try{p.lock(!0);const{valid:a}=yield o.validate();if(!a)return;const t=z(yield o.getValues());yield d.value?Q(t):K(t),I(),i("reload"),p.close()}catch(a){console.error(a)}finally{p.lock(!1)}})}function P(){return l(this,null,function*(){yield o.resetForm(),I()})}return(a,t)=>(G(),E(C($),{title:f.value,class:"w-[600px]"},{default:U(()=>[W(C(N))]),_:1},8,["title"]))}});export{fe as _,me as a,ue as c,j as d,ce as q};
