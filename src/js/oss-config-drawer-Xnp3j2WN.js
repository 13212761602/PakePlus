var p=(e,t,n)=>new Promise((r,f)=>{var m=o=>{try{d(n.next(o))}catch(i){f(i)}},s=o=>{try{d(n.throw(o))}catch(i){f(i)}},d=o=>o.done?r(o.value):Promise.resolve(o.value).then(m,s);d((n=n.apply(e,t)).next())});import{y as u,ap as y,$ as C,z as P}from"./bootstrap-CbEyMBZc.js";import{u as k}from"./form-DcAycvJX.js";import{u as q,d as h}from"./popup-DepLi2Z4.js";import{g as N}from"./dict-LWP2femj.js";import{T as x}from"./index-D7oCs85i.js";import{a as B}from"./use-vben-form-CDDuv56b.js";import{a as b,d as K,p as V,B as O,S as L,h as T,o as $,w,b as g,j as z}from"../jse/index-index-CKHiV3bJ.js";import{u as A}from"./use-drawer-ZsTa9Rf6.js";import{A as F}from"./index-B1E3W4TM.js";function se(e){return u.get("/resource/oss/config/list",{params:e})}function G(e){return u.get(`/resource/oss/config/${e}`)}function M(e){return u.postWithMsg("/resource/oss/config",e)}function W(e){return u.putWithMsg("/resource/oss/config",e)}function ae(e){return u.deleteWithMsg(`/resource/oss/config/${e}`)}function re(e){const t={ossConfigId:e.ossConfigId,status:e.status,configKey:e.configKey};return u.putWithMsg("/resource/oss/config/changeStatus",t)}const _=[{color:"orange",label:"私有",value:"0"},{color:"green",label:"公开",value:"1"},{color:"blue",label:"自定义",value:"2"}],ie=()=>[{component:"Input",fieldName:"configKey",label:"配置名称"},{component:"Input",fieldName:"bucketName",label:"桶名称"},{component:"Select",componentProps:{options:N(y.SYS_YES_NO)},fieldName:"status",label:"是否默认"}],le=[{type:"checkbox",width:60},{title:"配置名称",field:"configKey"},{title:"访问站点",field:"endpoint",showOverflow:!0},{title:"桶名称",field:"bucketName"},{title:"域",field:"region"},{title:"权限桶类型",field:"accessPolicy",slots:{default:({row:e})=>{const t=_.find(n=>n.value===e.accessPolicy);return t?b(x,{color:t.color},{default:()=>[t.label]}):"未知类型"}}},{title:"是否默认",field:"status",slots:{default:"status"}},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",resizable:!1,width:"auto"}],Y=()=>[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"ossConfigId"},{component:"Divider",componentProps:{orientation:"center"},fieldName:"divider1",hideLabel:!0,renderComponentContent:()=>({default:()=>"基本信息"})},{component:"Input",fieldName:"configKey",label:"配置名称",rules:"required"},{component:"Input",fieldName:"endpoint",label:"服务地址",renderComponentContent:e=>({addonBefore:()=>e.isHttps==="Y"?"https://":"http://"}),rules:B().refine(e=>e&&!/^https?:\/\/.*/.test(e),{message:"请输入正确的域名, 不需要http(s)"})},{component:"Input",fieldName:"domain",label:"自定义域名"},{component:"Input",fieldName:"tip",label:"占位作为提示使用",hideLabel:!0},{component:"Divider",componentProps:{orientation:"center"},fieldName:"divider2",hideLabel:!0,renderComponentContent:()=>({default:()=>"认证信息"})},{component:"Input",fieldName:"accessKey",label:"accessKey",rules:"required"},{component:"Input",fieldName:"secretKey",label:"secretKey",rules:"required"},{component:"Divider",componentProps:{orientation:"center"},fieldName:"divider3",hideLabel:!0,renderComponentContent:()=>({default:()=>"其他信息"})},{component:"Input",fieldName:"bucketName",label:"桶名称",rules:"required"},{component:"Input",fieldName:"prefix",label:"前缀"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:_,optionType:"button"},defaultValue:"0",fieldName:"accessPolicy",formItemClass:"col-span-3 lg:col-span-2",label:"权限桶类型"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:N(y.SYS_YES_NO),optionType:"button"},defaultValue:"N",fieldName:"isHttps",formItemClass:"col-span-3 lg:col-span-1",label:"是否https",rules:"required"},{component:"Input",fieldName:"region",label:"区域"},{component:"Textarea",fieldName:"remark",formItemClass:"items-start",label:"备注"}],j={class:"ml-7 w-full"},E=K({__name:"oss-config-drawer",emits:["reload"],setup(e,{emit:t}){const n=t,r=V(!1),f=O(()=>r.value?C("pages.common.edit"):C("pages.common.add")),[m,s]=k({commonConfig:{formItemClass:"col-span-3",labelWidth:100},schema:Y(),showDefaultActions:!1,wrapperClass:"grid-cols-3"}),{onBeforeClose:d,markInitialized:o,resetInitialized:i}=q({initializedGetter:h(s),currentGetter:h(s)}),[I,l]=A({onBeforeClose:d,onClosed:S,onConfirm:v,onOpenChange(c){return p(this,null,function*(){if(!c)return null;l.drawerLoading(!0);const{id:a}=l.getData();if(r.value=!!a,r.value&&a){const D=yield G(a);yield s.setValues(D)}yield o(),l.drawerLoading(!1)})}});function v(){return p(this,null,function*(){try{l.lock(!0);const{valid:c}=yield s.validate();if(!c)return;const a=L(yield s.getValues());yield r.value?W(a):M(a),i(),n("reload"),l.close()}catch(c){console.error(c)}finally{l.lock(!1)}})}function S(){return p(this,null,function*(){yield s.resetForm(),i()})}return(c,a)=>($(),T(g(I),{title:f.value,class:"w-[650px]"},{default:w(()=>[b(g(m),null,{tip:w(()=>[z("div",j,[b(g(F),{message:"私有桶使用自定义域名无法预览, 但可以正常上传/下载","show-icon":"",type:"warning"})])]),_:1})]),_:1},8,["title"]))}}),R=P(E,[["__scopeId","data-v-e5b35095"]]),ce=Object.freeze(Object.defineProperty({__proto__:null,default:R},Symbol.toStringTag,{value:"Module"}));export{re as a,se as b,le as c,ae as d,ce as e,R as o,ie as q};
