import{d as y,h as m,o as D,w as d,r as v,a as k,n as w,b as g,G as O,p as G,q as z,ak as C,A as M}from"../jse/index-index-CKHiV3bJ.js";import{w as F,cg as L}from"./bootstrap-CbEyMBZc.js";const b=F("circle-help",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),W=y({inheritAttrs:!1,__name:"help-tooltip",props:{triggerClass:{}},setup(i){return(s,t)=>(D(),m(L,{"delay-duration":300,side:"top"},{trigger:d(()=>[v(s.$slots,"trigger",{},()=>[k(g(b),{class:w(g(O)("text-foreground/80 hover:text-foreground inline-flex size-5 cursor-pointer",s.triggerClass))},null,8,["class"])])]),default:d(()=>[v(s.$slots,"default")]),_:3}))}}),o=new WeakMap,p=new WeakMap,u={current:[]};let f=!1;const c=new Set,_=new Map;function V(i){const s=Array.from(i).sort((t,e)=>t instanceof l&&t.options.deps.includes(e)?1:e instanceof l&&e.options.deps.includes(t)?-1:0);for(const t of s){if(u.current.includes(t))continue;u.current.push(t),t.recompute();const e=p.get(t);if(e)for(const r of e){const n=o.get(r);n&&V(n)}}}function R(i){i.listeners.forEach(s=>s({prevVal:i.prevState,currentVal:i.state}))}function T(i){i.listeners.forEach(s=>s({prevVal:i.prevState,currentVal:i.state}))}function x(i){var s;if(c.add(i),!f)try{for(f=!0;c.size>0;){const t=Array.from(c);c.clear();for(const e of t){const r=(s=_.get(e))!=null?s:e.prevState;e.prevState=r,R(e)}for(const e of t){const r=o.get(e);r&&(u.current.push(e),V(r))}for(const e of t){const r=o.get(e);if(r)for(const n of r)T(n)}}}finally{f=!1,u.current=[],_.clear()}}class S{constructor(s,t){this.listeners=new Set,this.subscribe=e=>{var r,n;this.listeners.add(e);const a=(n=(r=this.options)==null?void 0:r.onSubscribe)==null?void 0:n.call(r,e,this);return()=>{this.listeners.delete(e),a==null||a()}},this.setState=e=>{var r,n,a;this.prevState=this.state,this.state=(r=this.options)!=null&&r.updateFn?this.options.updateFn(this.prevState)(e):e(this.prevState),(a=(n=this.options)==null?void 0:n.onUpdate)==null||a.call(n),x(this)},this.prevState=s,this.state=s,this.options=t}}class l{constructor(s){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{var r;const t=[],e=[];for(const n of this.options.deps)t.push(n.prevState),e.push(n.state);return this.lastSeenDepValues=e,{prevDepVals:t,currDepVals:e,prevVal:(r=this.prevState)!=null?r:void 0}},this.recompute=()=>{var t,e;this.prevState=this.state;const{prevDepVals:r,currDepVals:n,prevVal:a}=this.getDepVals();this.state=this.options.fn({prevDepVals:r,currDepVals:n,prevVal:a}),(e=(t=this.options).onUpdate)==null||e.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const n of this.options.deps)n instanceof l&&n.checkIfRecalculationNeededDeeply();let t=!1;const e=this.lastSeenDepValues,{currDepVals:r}=this.getDepVals();for(let n=0;n<r.length;n++)if(r[n]!==e[n]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var e,r;this.listeners.add(t);const n=(r=(e=this.options).onSubscribe)==null?void 0:r.call(e,t,this);return()=>{this.listeners.delete(t),n==null||n()}},this.options=s,this.state=s.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(s=this.options.deps){for(const t of s)if(t instanceof l)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof S){let e=o.get(t);e||(e=new Set,o.set(t,e)),e.add(this);let r=p.get(this);r||(r=new Set,p.set(this,r)),r.add(t)}}unregisterFromGraph(s=this.options.deps){for(const t of s)if(t instanceof l)this.unregisterFromGraph(t.options.deps);else if(t instanceof S){const e=o.get(t);e&&e.delete(this);const r=p.get(this);r&&r.delete(t)}}}function $(i,s=t=>t){const t=G(s(i.state));return z(()=>i,(e,r,n)=>{const a=e.subscribe(()=>{const h=s(e.state);I(M(t.value),h)||(t.value=h)});n(()=>{a()})},{immediate:!0}),C(t)}function I(i,s){if(Object.is(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;if(i instanceof Map&&s instanceof Map){if(i.size!==s.size)return!1;for(const[e,r]of i)if(!s.has(e)||!Object.is(r,s.get(e)))return!1;return!0}if(i instanceof Set&&s instanceof Set){if(i.size!==s.size)return!1;for(const e of i)if(!s.has(e))return!1;return!0}const t=Object.keys(i);if(t.length!==Object.keys(s).length)return!1;for(let e=0;e<t.length;e++)if(!Object.prototype.hasOwnProperty.call(s,t[e])||!Object.is(i[t[e]],s[t[e]]))return!1;return!0}export{b as C,S,W as _,$ as u};
