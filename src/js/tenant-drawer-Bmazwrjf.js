var m=(e,f,i)=>new Promise((o,c)=>{var u=n=>{try{s(i.next(n))}catch(d){c(d)}},t=n=>{try{s(i.throw(n))}catch(d){c(d)}},s=n=>n.done?o(n.value):Promise.resolve(n.value).then(u,t);s((i=i.apply(e,f)).next())});import{$ as h,z as y}from"./bootstrap-CbEyMBZc.js";import{u as _}from"./form-DcAycvJX.js";import{f as x,u as S,g as Y,h as F}from"./tenant-CHGD6Hfo.js";import{g as T}from"./index-DM1WbR0K.js";import{u as L,d as g}from"./popup-DepLi2Z4.js";import{X as B,d as q,p as v,B as M,S as V,h as z,o as H,w as U,a as A,b as w}from"../jse/index-index-CKHiV3bJ.js";import{a as I}from"./use-vben-form-CDDuv56b.js";import{a as N}from"./get-popup-container-P4S1sr5h.js";import{u as O}from"./use-drawer-ZsTa9Rf6.js";const ae=()=>[{component:"Input",fieldName:"tenantId",label:"租户编号"},{component:"Input",fieldName:"companyName",label:"租户名称"},{component:"Input",fieldName:"contactUserName",label:"联系人"},{component:"Input",fieldName:"contactPhone",label:"联系电话"},{component:"RangePicker",fieldName:"expireTime",label:"到期时间"}],oe=[{type:"checkbox",width:60},{title:"租户编号1",field:"tenantId",sortable:!0},{title:"租户名称",field:"companyName"},{title:"联系人",field:"contactUserName"},{title:"联系电话",field:"contactPhone"},{title:"到期时间",field:"expireTime",formatter:({cellValue:e})=>e||"无期限"},{title:"租户状态",field:"status",slots:{default:"status"}},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",resizable:!1,width:"auto"}],$=B().add(365,"days").startOf("day").format("YYYY-MM-DD HH:mm:ss"),j=()=>[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"id",label:"id"},{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"tenantId",label:"tenantId"},{component:"Divider",componentProps:{orientation:"center"},fieldName:"divider1",hideLabel:!0,renderComponentContent:()=>({default:()=>"基本信息"})},{component:"Input",fieldName:"companyName",label:"企业名称",rules:"required"},{component:"Input",fieldName:"contactUserName",label:"联系人",rules:"required"},{component:"Input",fieldName:"contactPhone",label:"联系电话",rules:I().regex(/^1[3-9]\d{9}$/,{message:"请输入正确的联系电话"})},{component:"Divider",componentProps:{orientation:"center"},fieldName:"divider2",hideLabel:!0,renderComponentContent:()=>({default:()=>"管理员信息"}),dependencies:{if:e=>!(e!=null&&e.tenantId),triggerFields:["tenantId"]}},{component:"Input",fieldName:"username",label:"用户账号",rules:"required",dependencies:{if:e=>!(e!=null&&e.tenantId),triggerFields:["tenantId"]}},{component:"InputPassword",fieldName:"password",label:"用户密码",rules:"required",dependencies:{if:e=>!(e!=null&&e.tenantId),triggerFields:["tenantId"]}},{component:"Divider",componentProps:{orientation:"center"},fieldName:"divider3",hideLabel:!0,renderComponentContent:()=>({default:()=>"租户设置"})},{component:"Select",componentProps:{getPopupContainer:N},fieldName:"packageId",label:"租户套餐",rules:"selectRequired"},{component:"DatePicker",componentProps:{format:"YYYY-MM-DD HH:mm:ss",showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",getPopupContainer:N},defaultValue:$,fieldName:"expireTime",help:`已经设置过期时间不允许重置为'无期限'
即在开通时未设置无期限 以后都不允许设置`,label:"过期时间"},{component:"InputNumber",componentProps:{min:-1},defaultValue:-1,fieldName:"accountCount",help:"-1不限制用户数量",label:"用户数量",renderComponentContent(e){return{addonBefore:()=>e.accountCount===-1?"不限制数量":"输入数量"}},rules:"required"},{component:"Input",fieldName:"domain",help:"可填写域名/端口 填写域名如: www.test.com 或者 www.test.com:8080 填写ip:端口如: 127.0.0.1:8080",label:"绑定域名",renderComponentContent(){return{addonBefore:()=>"http(s)://"}},rules:I().refine(e=>!(e.startsWith("http://")||e.startsWith("https://")),{message:"请输入正确的域名, 不需要http(s)"}).optional()},{component:"Divider",componentProps:{orientation:"center"},fieldName:"divider4",hideLabel:!0,renderComponentContent:()=>({default:()=>"企业信息"})},{component:"Input",fieldName:"address",label:"企业地址"},{component:"Input",fieldName:"licenseNumber",label:"企业代码"},{component:"Textarea",fieldName:"intro",formItemClass:"items-start",label:"企业介绍"},{component:"Textarea",fieldName:"remark",formItemClass:"items-start",label:"备注"}],G=q({__name:"tenant-drawer",emits:["reload"],setup(e,{emit:f}){const i=f,o=v(!1),c=M(()=>o.value?h("pages.common.edit"):h("pages.common.add")),[u,t]=_({commonConfig:{formItemClass:"col-span-2",labelWidth:100,componentProps:{class:"w-full"}},schema:j(),showDefaultActions:!1,wrapperClass:"grid-cols-2"});function s(){return m(this,null,function*(){const a=(yield T()).map(p=>({label:p.packageName,value:p.packageId}));t.updateSchema([{componentProps:{optionFilterProp:"label",optionLabelProp:"label",options:a,showSearch:!0},fieldName:"packageId"}])})}const{onBeforeClose:n,markInitialized:d,resetInitialized:b}=L({initializedGetter:g(t),currentGetter:g(t)}),[C,l]=O({onBeforeClose:n,onClosed:k,onConfirm:D,onOpenChange(r){return m(this,null,function*(){if(!r)return null;l.drawerLoading(!0);const{id:a}=l.getData();if(o.value=!!a,yield s(),o.value&&a){const p=yield x(a);yield t.setValues(p)}t.updateSchema([{fieldName:"packageId",componentProps:{disabled:o.value}}]),yield d(),l.drawerLoading(!1)})}}),P=S();function D(){return m(this,null,function*(){try{l.lock(!0);const{valid:r}=yield t.validate();if(!r)return;const a=V(yield t.getValues());yield o.value?Y(a):F(a),b(),i("reload"),l.close(),P.initTenant()}catch(r){console.error(r)}finally{l.lock(!1)}})}function k(){return m(this,null,function*(){yield t.resetForm(),b()})}return(r,a)=>(H(),z(w(C),{title:c.value,class:"w-[600px]"},{default:U(()=>[A(w(u))]),_:1},8,["title"]))}}),W=y(G,[["__scopeId","data-v-81c4f936"]]),re=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{re as a,oe as c,ae as q,W as t};
