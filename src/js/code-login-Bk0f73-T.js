var f=(h,m,s)=>new Promise((r,c)=>{var d=e=>{try{i(s.next(e))}catch(t){c(t)}},p=e=>{try{i(s.throw(e))}catch(t){c(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(d,p);i((s=s.apply(h,m)).next())});import{aG as k,$ as o,aH as N,D as E,an as V,ak as x,aW as B}from"./bootstrap-CbEyMBZc.js";import{s as $}from"./captcha-BaKBsjZO.js";import{A as F}from"./index-B1E3W4TM.js";import{T as P}from"./auth-title-eqCoA6sQ.js";import{u as D,a as v}from"./use-vben-form-CDDuv56b.js";import{d as C,s as R,B as A,c as I,o as S,a as u,w as g,r as w,k as b,t as T,b as l,j as q,n as G,p as y,E as H,v as M}from"../jse/index-index-CKHiV3bJ.js";import"./index-C0ExvxMt.js";import"./checkbox.vue_vue_type_script_setup_true_lang-53DrAgf8.js";import"./render-content.vue_vue_type_script_lang-h-IJYrAt.js";const j={class:"text-muted-foreground"},z=C({name:"AuthenticationCodeLogin",__name:"code-login",props:{formSchema:{},loading:{type:Boolean,default:!1},loginPath:{default:"/auth/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(h,{expose:m,emit:s}){const r=h,c=s,d=k(),[p,i]=D(R({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:A(()=>r.formSchema),showDefaultActions:!1}));function e(){return f(this,null,function*(){const{valid:a}=yield i.validate(),n=yield i.getValues();a&&c("submit",{tenantId:n==null?void 0:n.tenantId,code:n==null?void 0:n.code,phoneNumber:n==null?void 0:n.phoneNumber})})}function t(){d.push(r.loginPath)}return m({getFormApi:()=>i}),(a,n)=>(S(),I("div",null,[u(P,null,{desc:g(()=>[q("span",j,[w(a.$slots,"subTitle",{},()=>[b(T(a.subTitle||l(o)("authentication.codeSubtitle")),1)])])]),default:g(()=>[w(a.$slots,"title",{},()=>[b(T(a.title||l(o)("authentication.welcomeBack"))+" 📲 ",1)])]),_:3}),u(l(p)),u(l(N),{class:G([{"cursor-wait":a.loading},"w-full"]),loading:a.loading,onClick:e},{default:g(()=>[w(a.$slots,"submitButtonText",{},()=>[b(T(a.submitButtonText||l(o)("common.login")),1)])]),_:3},8,["class","loading"]),u(l(N),{class:"mt-4 w-full",variant:"outline",onClick:n[0]||(n[0]=L=>t())},{default:g(()=>[b(T(l(o)("common.back")),1)]),_:1})]))}}),_=4,te=C({name:"CodeLogin",__name:"code-login",setup(h){const m=y(!1),s=y({tenantEnabled:!1,voList:[]}),r=H("codeLoginRef");function c(){return f(this,null,function*(){var t;const e=yield B();if(s.value=e,e.tenantEnabled&&e.voList.length>0){const a=e.voList[0].tenantId;(t=r.value)==null||t.getFormApi().setFieldValue("tenantId",a)}})}M(c);const d=A(()=>{var e;return[{component:"VbenSelect",componentProps:{class:"bg-background h-[40px] focus:border-primary",contentClass:"max-h-[256px] overflow-y-auto",options:(e=s.value.voList)==null?void 0:e.map(t=>({label:t.companyName,value:t.tenantId})),placeholder:o("authentication.selectAccount")},defaultValue:E,dependencies:{if:()=>s.value.tenantEnabled,triggerFields:[""]},fieldName:"tenantId",label:o("authentication.selectAccount"),rules:v().min(1,{message:o("authentication.selectAccount")})},{component:"VbenInput",componentProps:{placeholder:o("authentication.mobile")},fieldName:"phoneNumber",label:o("authentication.mobile"),rules:v().min(1,{message:o("authentication.mobileTip")}).refine(t=>/^\d{11}$/.test(t),{message:o("authentication.mobileErrortip")})},{component:"VbenPinInput",componentProps(t,a){return{createText:n=>n>0?o("authentication.sendText",[n]):o("authentication.sendCode"),codeLength:_,placeholder:o("authentication.code"),handleSendCode:()=>f(null,null,function*(){const{valid:n,value:L}=yield a.validateField("phoneNumber");if(!n)throw new Error("未填写手机号");yield $(L),V.success("验证码发送成功")})}},fieldName:"code",label:o("authentication.code"),rules:v().length(_,{message:o("authentication.codeTip",[_])})}]}),p=x();function i(e){return f(this,null,function*(){try{const t={tenantId:e.tenantId,phonenumber:e.phoneNumber,smsCode:e.code,grantType:"sms"};console.log("login params",t),yield p.authLogin(t)}catch(t){console.error(t)}})}return(e,t)=>(S(),I("div",null,[u(l(F),{class:"mb-4","how-icon":"",message:"测试手机号: 15888888888 正确验证码: 1234 演示使用 不会真的发送",type:"info"}),u(l(z),{ref_key:"codeLoginRef",ref:r,"form-schema":d.value,loading:m.value,onSubmit:i},null,8,["form-schema","loading"])]))}});export{te as default};
