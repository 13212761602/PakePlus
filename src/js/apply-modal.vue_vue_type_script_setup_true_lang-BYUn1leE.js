var g=(b,p,s)=>new Promise((u,a)=>{var d=t=>{try{n(s.next(t))}catch(e){a(e)}},r=t=>{try{n(s.throw(t))}catch(e){a(e)}},n=t=>t.done?u(t.value):Promise.resolve(t.value).then(d,r);n((s=s.apply(b,p)).next())});import{u as L}from"./form-DcAycvJX.js";import{g as k,c as x}from"./index-BCokd8-c.js";import{as as V}from"./bootstrap-CbEyMBZc.js";import"./approval-card.vue_vue_type_style_index_0_scoped_90981e93_lang-CFyUrHXN.js";import"./vxe-table-5UTMlFMN.js";/* empty css                                                          */import{_ as I}from"./copy-component.vue_vue_type_script_setup_true_lang-9yx0-G2y.js";import{d as N,h as B,o as D,w,a as y,b as C}from"../jse/index-index-CKHiV3bJ.js";import{u as T}from"./use-modal-BtBQhM0d.js";const E=N({__name:"apply-modal",emits:["complete"],setup(b,{emit:p}){const s=p,[u,a]=T({title:"流程发起",fullscreenButton:!1,onConfirm:n,onOpenChange(e){return g(this,null,function*(){var i;if(!e)return null;const{taskId:c}=a.getData(),l=yield k(c),o={};l.buttonList.forEach(m=>{o[m.code]=m.show});const f=(i=o==null?void 0:o.copy)!=null?i:!1;r.updateSchema([{fieldName:"flowCopyList",dependencies:{if:f,triggerFields:[""]}}])})}}),[d,r]=L({commonConfig:{formItemClass:"col-span-2",labelWidth:100,componentProps:{class:"w-full"}},schema:[{fieldName:"messageType",component:"CheckboxGroup",componentProps:{options:[{label:"站内信",value:"1",disabled:!0},{label:"邮件",value:"2"},{label:"短信",value:"3"}]},label:"通知方式",defaultValue:["1"]},{fieldName:"attachment",component:"FileUpload",componentProps:{maxCount:10,maxSize:20,accept:"png, jpg, jpeg, doc, docx, xlsx, xls, ppt, pdf"},defaultValue:[],label:"附件上传",formItemClass:"items-start"},{fieldName:"flowCopyList",component:"Input",defaultValue:[],label:"抄送人"}],showDefaultActions:!1,wrapperClass:"grid-cols-2"});function n(){return g(this,null,function*(){try{a.modalLoading(!0);const{messageType:e,flowCopyList:c,attachment:l}=V(yield r.getValues()),{taskId:o,taskVariables:f,variables:i}=a.getData(),m=c.map(h=>({userId:h.userId,userName:h.nickName})),_={fileId:l.join(","),messageType:e,flowCopyList:m,taskId:o,taskVariables:f,variables:i};yield x(_),a.close(),s("complete")}catch(e){console.error(e)}finally{a.modalLoading(!1)}})}return(e,c)=>(D(),B(C(u),null,{default:w(()=>[y(C(d),null,{flowCopyList:w(l=>[y(C(I),{"user-list":l.modelValue,"onUpdate:userList":o=>l.modelValue=o},null,8,["user-list","onUpdate:userList"])]),_:1})]),_:1}))}});export{E as _};
