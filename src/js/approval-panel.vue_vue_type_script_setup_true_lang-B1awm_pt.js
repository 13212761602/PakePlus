var y=(k,m,n)=>new Promise((u,c)=>{var T=g=>{try{h(n.next(g))}catch(b){c(b)}},v=g=>{try{h(n.throw(g))}catch(b){c(b)}},h=g=>g.done?u(g.value):Promise.resolve(g.value).then(T,v);h((n=n.apply(k,m)).next())});import{av as he,bE as Me,aG as Se,ap as Oe,al as O,an as Ae}from"./bootstrap-CbEyMBZc.js";import{a as r,d as $e,p as A,B as I,ac as Pe,q as Te,y as Be,af as Ne,l as xe,h as d,o as l,b as a,w as s,j as i,c as De,f,t as $,P as je,k as p}from"../jse/index-index-CKHiV3bJ.js";import{f as Re,c as ze,d as Fe}from"./index-BCj7hz3q.js";import{g as Ve,t as B,u as Ee,e as He}from"./index-BCokd8-c.js";import{r as Ue}from"./render-C2mFGEaj.js";import"./form-DcAycvJX.js";import{a as j}from"./approval-card.vue_vue_type_style_index_0_scoped_90981e93_lang-CFyUrHXN.js";import{_ as qe}from"./approval-modal.vue_vue_type_script_setup_true_lang-r4oC-lZq.js";import{_ as We}from"./approval-details.vue_vue_type_script_setup_true_lang-CTP2jlly.js";import P from"./user-select-modal-CF4g6nsp.js";import{_ as Ge}from"./approval-rejection-modal.vue_vue_type_script_setup_true_lang-DB_t6bkD.js";import{_ as Ye}from"./flow-interfere-modal.vue_vue_type_script_setup_true_lang-5N7VWWsA.js";import{C as Je}from"./index-BPV6pKaP.js";import{_ as Le}from"./avatar.vue_vue_type_script_setup_true_lang-CZ6M6Zo9.js";import{a as Qe,T as Y}from"./index-65hk_V-f.js";import R from"./index-Yd03BW_o.js";import{M as Xe,a as N}from"./index-CQDwpHx9.js";import{a as Ze}from"./get-popup-container-P4S1sr5h.js";import{D as Ke}from"./index-DWD1gEWB.js";import{_ as et}from"./fallback.vue_vue_type_script_setup_true_lang-ChoFPR3D.js";import{u as C}from"./use-modal-BtBQhM0d.js";import tt from"./index-DMCjRHjH.js";var nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"}}]},name:"copy",theme:"outlined"};function J(k){for(var m=1;m<arguments.length;m++){var n=arguments[m]!=null?Object(arguments[m]):{},u=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),u.forEach(function(c){at(k,c,n[c])})}return k}function at(k,m,n){return m in k?Object.defineProperty(k,m,{value:n,enumerable:!0,configurable:!0,writable:!0}):k[m]=n,k}var z=function(m,n){var u=J({},m,n.attrs);return r(he,J({},u,{icon:nt}),null)};z.displayName="CopyOutlined";z.inheritAttrs=!1;const ot={class:"flex items-center gap-2"},st={class:"flex flex-col gap-5 p-4"},rt={class:"flex flex-col gap-3"},it={class:"flex items-center gap-2"},lt={class:"text-2xl font-bold"},dt={class:"flex items-center gap-2"},ut={class:"flex items-center opacity-50"},ft={class:"flex items-center gap-1"},pt={class:"flex items-center gap-1"},mt=["src"],ct={key:0,class:"border-t-solid bg-background absolute bottom-0 left-0 w-full border-t-[1px] p-3"},kt={class:"flex justify-end"},Ft=$e({name:"ApprovalPanel",inheritAttrs:!1,__name:"approval-panel",props:{task:{},type:{}},emits:["reload"],setup(k,{emit:m}){const n=k,u=m,c=A(),T=I(()=>c.value?Number(c.value.nodeRatio)>0:!1),v=I(()=>{const t={};return c.value&&c.value.buttonList.forEach(e=>{t[e.code]=e.show}),t}),h=I(()=>{const t=new Set(["addSign","subSign","transfer","trust"]);return Object.keys(v.value).some(e=>t.has(e)&&v.value[e])}),g=I(()=>{var t,e;return!(n.type==="readonly"||n.type==="myself"&&["finish","invalid"].includes((e=(t=n.task)==null?void 0:t.flowStatus)!=null?e:""))}),b=A(),x=A(!1),D=A(!1),F=A(300);Pe("message",t=>{const e=t.data;if(Me(e)&&(e.type==="mounted"&&(D.value=!0),e.type==="height")){const o=e.height;F.value=o}});function V(t){return y(this,null,function*(){try{if(!t)return null;x.value=!0,D.value=!1;const e=yield Re(t.businessId);b.value=e;const o=yield Ve(n.task.id);c.value=o}catch(e){console.error(e)}finally{x.value=!1}})}Te(()=>n.task,V),Be(()=>b.value=void 0);const L=I(()=>{var t;return((t=n.task)==null?void 0:t.flowStatus)==="waiting"});function Q(){return y(this,null,function*(){O.confirm({title:"提示",content:"确定要撤销该申请吗？",centered:!0,okButtonProps:{danger:!0},onOk:()=>y(null,null,function*(){yield ze({businessId:n.task.businessId,message:"申请人撤销流程！"}),u("reload")})})})}const E=I(()=>n.task?["back","cancel","draft"].includes(n.task.flowStatus):!1),X=Se();function Z(){var e;const t=(e=n.task)==null?void 0:e.formPath;t&&X.push({path:t,query:{id:n.task.businessId}})}function K(){O.confirm({title:"提示",content:"确定删除该申请吗？",centered:!0,okButtonProps:{danger:!0},onOk:()=>y(null,null,function*(){yield Fe([n.task.id]),u("reload")})})}const[ee,H]=C({connectedComponent:Ge});function te(){var t,e,o;H.setData({taskId:(t=n.task)==null?void 0:t.id,definitionId:(e=n.task)==null?void 0:e.definitionId,nodeCode:(o=n.task)==null?void 0:o.nodeCode}),H.open()}function ne(){j({title:"审批终止",description:"确定终止当前审批流程吗？",onOk:t=>y(null,null,function*(){yield He({taskId:n.task.id,comment:t}),u("reload")})})}const[ae,U]=C({connectedComponent:qe});function oe(){var o,w,M,_,S;const t=(w=(o=v.value)==null?void 0:o.copy)!=null?w:!1,e=(_=(M=v.value)==null?void 0:M.pop)!=null?_:!1;U.setData({taskId:(S=n.task)==null?void 0:S.id,copyPermission:t,assignPermission:e}),U.open()}const[se,re]=C({connectedComponent:P});function ie(t){if(t.length===0)return;const e=t[0];j({title:"委托",description:`确定委托给[${e==null?void 0:e.nickName}]吗?`,onOk:o=>y(null,null,function*(){yield B({taskId:n.task.id,userId:e.userId,message:o},"delegateTask"),u("reload")})})}const[le,de]=C({connectedComponent:P});function ue(t){if(t.length===0)return;const e=t[0];j({title:"转办",description:`确定转办给[${e==null?void 0:e.nickName}]吗?`,onOk:o=>y(null,null,function*(){yield B({taskId:n.task.id,userId:e.userId,message:o},"transferTask"),u("reload")})})}const[fe,pe]=C({connectedComponent:P});function me(t){if(t.length===0)return;const e=t.map(o=>o.userId);O.confirm({title:"提示",content:"确认加签吗?",centered:!0,onOk:()=>y(null,null,function*(){yield B({taskId:n.task.id,userIds:e},"addSignature"),u("reload")})})}const[ce,ke]=C({connectedComponent:P});function ve(t){if(t.length===0)return;const e=t.map(o=>o.userId);O.confirm({title:"提示",content:"确认减签吗?",centered:!0,onOk:()=>y(null,null,function*(){yield B({taskId:n.task.id,userIds:e},"reductionSignature"),u("reload")})})}const[ye,q]=C({connectedComponent:Ye});function ge(){var t;q.setData({taskId:(t=n.task)==null?void 0:t.id}),q.open()}const[be,Ce]=C({connectedComponent:P});function we(t){if(t.length===0)return;const e=t[0];e&&O.confirm({title:"修改办理人",content:`确定修改办理人为${e==null?void 0:e.nickName}吗?`,centered:!0,onOk:()=>y(null,null,function*(){yield Ee([n.task.id],e.userId),u("reload")})})}const{copy:_e}=Ne({legacy:!0});function Ie(t){return y(this,null,function*(){yield _e(t),Ae.success("复制成功")})}return(t,e)=>{const o=xe("a-button");return t.task?(l(),d(a(Je),{key:0,"body-style":{overflowY:"auto",height:"100%"},loading:x.value,class:"thin-scrollbar flex-1 overflow-y-hidden",size:"small"},{title:s(()=>[i("div",ot,[i("div",null,"编号: "+$(t.task.id),1),r(a(z),{class:"cursor-pointer",onClick:e[0]||(e[0]=w=>Ie(t.task.id))})])]),extra:s(()=>[r(o,{size:"small",onClick:e[1]||(e[1]=()=>V(t.task))},{default:s(()=>e[10]||(e[10]=[i("div",{class:"flex items-center justify-center"},[i("span",{class:"icon-[material-symbols--refresh] size-24px"})],-1)])),_:1,__:[10]})]),default:s(()=>[i("div",st,[i("div",rt,[i("div",it,[i("div",lt,$(t.task.flowName),1),i("div",null,[(l(),d(je(a(Ue)(t.task.flowStatus,a(Oe).WF_BUSINESS_STATUS))))])]),i("div",dt,[r(a(Le),{alt:t.task.createByName,class:"bg-primary size-[28px] rounded-full text-white",src:""},null,8,["alt"]),i("span",null,$(t.task.createByName),1),i("div",ut,[i("div",ft,[e[11]||(e[11]=i("span",{class:"icon-[bxs--category-alt] size-[16px]"},null,-1)),p(" 流程分类: "+$(t.task.categoryName),1)]),r(a(tt),{type:"vertical"}),i("div",pt,[e[12]||(e[12]=i("span",{class:"icon-[mdi--clock-outline] size-[16px]"},null,-1)),p(" 提交时间: "+$(t.task.createTime),1)])])])]),b.value?(l(),d(a(Qe),{key:0,class:"flex-1"},{default:s(()=>[r(a(Y),{key:"1",tab:"审批详情"},{default:s(()=>[r(We,{"current-flow-info":b.value,"iframe-loaded":D.value,"iframe-height":F.value,task:t.task},null,8,["current-flow-info","iframe-loaded","iframe-height","task"])]),_:1}),r(a(Y),{key:"2",tab:"审批流程图"},{default:s(()=>[i("img",{src:`data:image/png;base64,${b.value.image}`,class:"rounded-lg border"},null,8,mt)]),_:1})]),_:1})):f("",!0)]),e[26]||(e[26]=i("div",{class:"h-[57px]"},null,-1)),g.value?(l(),De("div",ct,[i("div",kt,[t.type==="myself"?(l(),d(a(R),{key:0},{default:s(()=>[L.value?(l(),d(o,{key:0,danger:"",type:"primary",onClick:Q},{default:s(()=>e[13]||(e[13]=[p(" 撤销申请 ")])),_:1,__:[13]})):f("",!0),E.value?(l(),d(o,{key:1,onClick:Z},{default:s(()=>e[14]||(e[14]=[p(" 重新编辑 ")])),_:1,__:[14]})):f("",!0),E.value?(l(),d(o,{key:2,danger:"",type:"primary",onClick:K},{default:s(()=>e[15]||(e[15]=[p(" 删除 ")])),_:1,__:[15]})):f("",!0)]),_:1})):f("",!0),t.type==="approve"?(l(),d(a(R),{key:1},{default:s(()=>{var w,M;return[r(o,{type:"primary",onClick:oe},{default:s(()=>e[16]||(e[16]=[p("通过")])),_:1,__:[16]}),(w=v.value)!=null&&w.termination?(l(),d(o,{key:0,danger:"",type:"primary",onClick:ne},{default:s(()=>e[17]||(e[17]=[p(" 终止 ")])),_:1,__:[17]})):f("",!0),(M=v.value)!=null&&M.back?(l(),d(o,{key:1,danger:"",type:"primary",onClick:te},{default:s(()=>e[18]||(e[18]=[p(" 驳回 ")])),_:1,__:[18]})):f("",!0),r(a(Ke),{"get-popup-container":a(Ze),placement:"bottomRight"},{overlay:s(()=>[r(a(Xe),null,{default:s(()=>{var _,S,W,G;return[(_=v.value)!=null&&_.trust?(l(),d(a(N),{key:"1",onClick:e[2]||(e[2]=()=>a(re).open())},{default:s(()=>e[19]||(e[19]=[p(" 委托 ")])),_:1,__:[19]})):f("",!0),(S=v.value)!=null&&S.transfer?(l(),d(a(N),{key:"2",onClick:e[3]||(e[3]=()=>a(de).open())},{default:s(()=>e[20]||(e[20]=[p(" 转办 ")])),_:1,__:[20]})):f("",!0),T.value&&((W=v.value)!=null&&W.addSign)?(l(),d(a(N),{key:"3",onClick:e[4]||(e[4]=()=>a(pe).open())},{default:s(()=>e[21]||(e[21]=[p(" 加签 ")])),_:1,__:[21]})):f("",!0),T.value&&((G=v.value)!=null&&G.subSign)?(l(),d(a(N),{key:"4",onClick:e[5]||(e[5]=()=>a(ke).open())},{default:s(()=>e[22]||(e[22]=[p(" 减签 ")])),_:1,__:[22]})):f("",!0)]}),_:1})]),default:s(()=>[h.value?(l(),d(o,{key:0},{default:s(()=>e[23]||(e[23]=[p(" 其他 ")])),_:1,__:[23]})):f("",!0)]),_:1},8,["get-popup-container"]),r(a(ae),{onComplete:e[6]||(e[6]=_=>t.$emit("reload"))}),r(a(ee),{onComplete:e[7]||(e[7]=_=>t.$emit("reload"))}),r(a(se),{mode:"single",onFinish:ie}),r(a(le),{mode:"single",onFinish:ue}),r(a(fe),{mode:"multiple",onFinish:me}),r(a(ce),{mode:"multiple",onFinish:ve})]}),_:1})):f("",!0),t.type==="admin"?(l(),d(a(R),{key:2},{default:s(()=>[r(o,{onClick:ge},{default:s(()=>e[24]||(e[24]=[p(" 流程干预 ")])),_:1,__:[24]}),r(o,{onClick:e[8]||(e[8]=()=>a(Ce).open())},{default:s(()=>e[25]||(e[25]=[p(" 修改办理人 ")])),_:1,__:[25]}),r(a(ye),{onComplete:e[9]||(e[9]=w=>t.$emit("reload"))}),r(a(be),{mode:"single",onFinish:we})]),_:1})):f("",!0)])])):f("",!0)]),_:1,__:[26]},8,["loading"])):(l(),d(a(et),{key:1,title:"点击左侧选择"}))}}});export{Ft as _};
